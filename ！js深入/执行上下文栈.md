面试题导入

## ?谈谈你对javascript执行上下文栈的理解

😟这寄吧我怎么回答啊，不想要二本大二实习生直说



# 🤣👉执行栈和执行上下文

## 1，什么是执行上下文

执行上下文栈也叫调用栈

<u>执行上下文是 JavaScript 代码执行时的环境，其创建阶段会完成变量对象构建、作用域链确定、this 绑定等准备工作，为代码执行提供基础。</u>

java代码执行进入到一个环境^的时候，引擎^会先做一些准备工作，这个准备阶段（就是创建阶段）就叫做"**创建**执行上下文"

~~~js
//什么是引擎？
//负责解析、编译、执行js代码的核心程序，它是浏览器或node.js等js环境的心脏
//put it simple，就是”处理js代码的工具“

//什么是环境？
//指js执行环境。是代码运行时的具体"场景"
//>全局执行环境>函数执行环境>eval执行环境(少见)
//put it simple，就是代码运行时的"场景"
~~~

### js中的执行环境

>全局环境
>
>函数环境
>
>eval环境（少见）

对应的，就有三种执行上下文：

>全局执行上下文
>
>函数执行上下文
>
>eval执行上下文

### 执行流程

javascript程序运行时：

>进入全局环境，创建全局执行上下文
>
>遇到函数环境，创造函数执行上下文
>
>多个函数会创建多个函数执行上下文
>
>这些执行上下文以栈的形式管理

### 栈数据结构

后进先出

## 🤣👉2，js执行栈(调用栈)

js用栈来管理执行上下文的

[^js调用栈]: 调用栈是解析器（如浏览器中的的 *JavaScript* 解析器）的一种机制。1，当脚本要调用函数的时候，解析器把该函数推入到栈中并且执行这个函数；2，被这个函数中调用到的函数会进一步压入调用栈中；3，函数运行结束后，解释器把他从堆栈中取出，并在主代码列表中继续执行代码；4，如果栈占用的空间过大，则会导致栈溢出错误



### 执行栈的工作原理

![76378283212](C:\Users\30580\AppData\Local\Temp\1763782832124.png)

就是这样一个入栈出栈过程:

1,全局执行上下文一直在栈底

2，执行相应函数，那个函数的执行上下文就被压入栈顶

3，函数**执行完**，那个函数的执行上下文就出栈

4，关闭页面，全局执行上下文出栈。

### 😭栈溢出问题

执行栈的空间有限嘛，你在那一直压压压，栈就爆掉咯

~~~js
function foo() {
    foo();
}
foo();
// 报错：Uncaught RangeError: Maximum call stack size exceeded
~~~

为什么呢？检查一下：

1，无限递归

2，递归层级过深

3，忘记设置递归终止条件

## 3，执行上下文的生命周期

说了好多空的啊，把执行上下文换成其他东西也说得通吧😂

### 执行上下文到底做了什么？

和生命周期有关，分两个阶段

#### 阶段一：创建阶段

函数被调用时，会进入函数环境，为其创建一个执行上下文，此时进入创建阶段

##### 1，创建变量对象（VO）

>创建Arguments对象（并赋值）
>
>确定函数参数
>
>处理函数声明
>
>处理变量声明

//请注意，只有函数上下文才**可能**存在arguments对象，全局上下文没有arguments对象

##### 2，确定作用域链（scope）

>作用域由**函数定义位置**决定（词法作用域）
>
>决定了变量的查找规则

##### 3，确定this指向（this）

>this的值由调用方式决定
>
>在创建阶段（执行上下文）已经确定

###### 在创建阶段，可以把执行上下文环境看作一个对象。该对象拥有三个属性

~~~js
//这是一个一个执行上下文
executionContextObj={
    variableObject:{},
 //变量对象，里面包含arguments对象，形式参数，函数和局部变量
    scopeChain:{},
 //作用域链，包含内部上下文所有变量对象的列表
    this:{}
 //上下文中this的指向对象
}
~~~

🥰看看建立的变量对象(VO)里面

1，首先建立arguments对象。

2，然后确定形式参数。

3，检查当前执行上下文中的函数声明，找到一个函数声明，就在variableObject下面用函数名建立一个属性

[^属性值]: 就是指向该函数在内存地址引用。

4，最后确定当前上下文的局部变量。



#### 阶段二：执行阶段

（才到阶段二啊😰？什么鬼）

创造完成后，开始执行代码：

1. 变量赋值：给之前声明的变量赋值
2. 函数表达式赋值，处理函数表达式
3. 执行代码：按顺序执行函数体中的代码

> 阶段二好短啊🤣



案例理解执行上下文

![76379829859](C:\Users\30580\AppData\Local\Temp\1763798298596.png)

创建阶段的变量对象：

~~~js
fooExecutionContext={
	variableobject：{
    	arguments:{0:10,length:1},//首先创建arguments对象，包含值和这个伪数组的长度
    	i:10,//形参赋值
    	c:pointer to function c(),//函数声明提升。找到一个函数声明，就在variableObject下面用函数名建立一个属性，属性值就是指向该函数在内存地址引用。
		a:undefined,//确定局部变量
    	b:undefined//确定局部变量
},
    scopeChain:{},
    this:{}
}

~~~

执行阶段的变量对象：

~~~js
fooExecutionContext={
	variableobject：{
    	arguments:{0:10,length:1},
    	i:10,
    	c:pointer to function c(),
		a:"hello",//变量被赋值
    	b:pointer to function privateB()//函数表达式被赋值,执行阶段的第二个操作
},
    scopeChain:{},
    this:{}
}
~~~

## 关键要点总结

| 阶段     | 主要工作 | 变量状态     | 函数状态         |
| -------- | -------- | ------------ | ---------------- |
| 创建阶段 | 准备工作 | 声明但未赋值 | 完全可用         |
| 执行阶段 | 执行代码 | 获得实际值   | 函数表达式被赋值 |

（ps在片尾把面试题的参考答案粘贴过来了）

### Q：谈谈你对js执行上下文栈的理解

### A：什么是执行上下文？

执行上下文是 JavaScript 代码执行时的环境抽象概念。每当代码运行时，都是在特定的执行上下文中运行的。(*执行阶段第三步，按顺序执行代码)

### 执行上下文的类型

javaScript 中有三种执行上下文：

1，**全局执行上下文：**这是默认或者说基础的上下文，<u>任何不在函数内部的代码都在全局上下文中</u>,它会执行两件事，创建一个全局的 *window* 对象(变量对象)（浏览器的情况下），并且设置 *this* 的值等于这个全局对象。一个程序中**只会有一个**全局执行上下文。

2，**函数执行上下文**：每当一个函数被调用时, 都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序执行一系列步骤。

3，**Eval 执行上下文：**执行在 *eval* 函数内部的代码也会有它属于自己的执行上下文

### 调用栈

###### js调用栈：调用栈是解析器（如浏览器中的的 *JavaScript* 解析器）的一种机制。1，当脚本要调用函数的时候，解析器把该函数推入到栈中并且执行这个函数；2，被这个函数中调用到的函数会进一步压入调用栈中；3，函数运行结束后，解释器把他从堆栈中取出，并在主代码列表中继续执行代码；**☠**4，如果栈占用的空间过大，则会导致栈溢出错误

